
<style>
  /* Sticky header */
  .table-responsive {
    max-height: 450px;
    overflow-y: auto;
  }
  thead th {
    position: sticky;
    top: 0;
    background: #212529;
    color: #fff;
    z-index: 10;
  }
  .styled-select option:hover,
  .styled-select option:checked,
  .styled-select option:focus {
    background-color: #743526 !important;
    color: white !important;
  }

  .styled-select option:focus {
  outline: none;
  background-color: #743526 !important;
  color: white !important;
}


  /* Zebra rows */
  tbody tr:nth-child(even) {
    background-color: #f8f9fa;
  }

  /* Highlight search matches */
  .highlight {
    background: #ffe066;
    padding: 2px 4px;
    border-radius: 4px;
  }

  .table-responsive {
    max-height: 450px;
    overflow-y: auto;
}

/* PAGINATION COLORS */
.pagination .page-item.active .page-link {
  background-color: #ffa323 !important;
  border-color: #ffa323 !important;
  color: white !important;
}

.pagination .page-item .page-link {
  color: #ffa323;
  background: white;
}

/* Hover */
.pagination .page-item .page-link:hover {
  background-color: #ffa323;
  color: white;
}
.export-gap{
    gap:10px;
}
/* THEMED SELECT (Two-tone #3D1A1C + #743526) */
.styled-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-color: white;
  border: 2px solid #743526;              /* Accent border */
  padding: 8px 40px 8px 12px;             /* space for custom arrow */
  border-radius: 8px;

  font-weight: 600;
  color: #3D1A1C;                         /* Dark text */
  cursor: pointer;

  /* Custom SVG arrow in accent color */
  background-image: url("data:image/svg+xml;utf8, <svg fill='%23743526' height='22' width='22' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 16px;

  transition: 0.2s ease-in-out;
}

/* Hover Effect */
.styled-select:hover {
  background-color: #f8f2f3;              /* very soft tint */
  border-color: #743526;
}

/* Focus Glow */
.styled-select:focus {
  outline: none;
  border-color: #743526;
  box-shadow: 0 0 6px rgba(116, 53, 38, 0.6); /* Accent glow */
}

/* Dropdown list styling */
.styled-select option {
  font-weight: 500;
  color: #3D1A1C;
  background: white;
}


thead th {
  position: sticky;
  top: 60px;   /* adjust based on navbar height */
  z-index: 1;
  background: #212529;
  color: #fff;
}

.export-btn{
    background-color: #3D1A1C;
    color: #fff;
}


.export-btn:hover{
    background-color: #fff;
    color: #3D1A1C;
    border: 1px solid #3D1A1C;
}

/* MAKE EVERYTHING SMALLER ON MOBILE (REVERT COMPLEX CHANGES) */
@media (max-width: 576px) {

  /* Reduce table font size */
  .mainTable td,
  .mainTable th {
    font-size: 11px;
    padding: 6px 8px;
  }

  /* Make search input smaller */
  .searchInput {
    margin-bottom: 14px;
    width: 100% !important;
    font-size: 14px;
    padding: 6px 10px;
    min-width: 180px;
  }

  /* Smaller select dropdown */
  .styled-select {
    width: 45%;
    padding: 6px 28px 6px 8px;
    font-size: 14px;
    border-width: 1.5px;
  }

  /* Smaller export button */
  .export-btn {
    width: 45%;
    font-size: 14px;
    padding: 6px 12px;
  }

  /* Reduce top bar spacing */
  .export-gap {
    width: 100%;
    justify-content:space-between;
    /* gap: 6px; */
  }

  /* Table header smaller */
  thead th {
    font-size: 13px;
    padding: 6px 8px;
  }

  /* Pagination smaller */
  .pagination .page-link {
    padding: 4px 8px;
    font-size: 13px;
  }
}

</style>

{{/* Render HTML for each table */}}
{{ range .tables }}
  <div class="pt-4 mb-5" id="{{ .id }}-wrapper">

    {{ with .name }}
<div style="display:flex; align-items:center; margin:40px 0;">

  <!-- Left gradient line -->
  <div style="
    flex:1;
    height:3px;
    background:linear-gradient(to right, transparent, #743526, transparent);
    border-radius:50px;
  "></div>

  <!-- Center label (your Hugo variable) -->
  <span style="
    padding:0 20px;
    font-size:22px;
    font-weight:600;
    color:#000;
    white-space:nowrap;
  ">
    {{ . }}
  </span>

  <!-- Right gradient line -->
  <div style="
    flex:1;
    height:3px;
    background:linear-gradient(to right, transparent, #743526, transparent);
    border-radius:50px;
  "></div>

</div>

    {{ end }}

    <div class="d-flex justify-content-between flex-wrap mb-3 gap-3">
      <input id="{{ .id }}-searchInput" type="text" class="searchInput form-control w-auto"
             style="min-width:250px" placeholder="Search...">

      <div class="d-flex export-gap">
        <select id="{{ .id }}-rowsSelect" class="styled-select">
          <option value="10" selected>10 rows</option>
          <option value="20">20 rows</option>
          <option value="50">50 rows</option>
        </select>

        <button id="{{ .id }}-csvExport" class="btn export-btn">
          Export CSV
        </button>
      </div>
    </div>

    <table class="table table-hover table-borderless mb-0 mainTable" id="{{ .id }}-mainTable">
      <thead class="table-dark">
        <tr>
          <th>S.No</th>
          {{ range .headers }}
            <th class="sortable" data-key="{{ . }}" style="cursor:pointer;">
              {{ . }} <span class="opacity-50">▲▼</span>
            </th>
          {{ end }}
        </tr>
      </thead>
      <tbody id="{{ .id }}-tableBody"></tbody>
    </table>

    <nav class="mt-3">
      <ul id="{{ .id }}-pagination" class="pagination justify-content-center"></ul>
    </nav>

  </div>


{{ end }}

<script>
(() => {

  // ----------------------------------
  // 1) COLLECT ALL TABLES IN ONE ARRAY
  // ----------------------------------
  const tables = [
    {{ range .tables }}
    {
      id: "{{ .id }}",
      headers: {{ .headers | jsonify }},
      rows: {{ .rows | jsonify }}
    },
    {{ end }}
  ];

  // ----------------------------------
  // 2) SUPPORT FUNCTIONS (only once)
  // ----------------------------------

  function highlight(text, query) {
    if (!query) return text;
    const seg = new Intl.Segmenter("ta", { granularity: "grapheme" });
    return Array.from(seg.segment(text))
      .map(g => g.segment.toLowerCase().includes(query)
        ? `<span class="highlight">${g.segment}</span>`
        : g.segment)
      .join("");
  }

  function tamilSort(a, b) {
    return a.localeCompare(b, "ta", { sensitivity: "base" });
  }

  // ----------------------------------
  // 3) START INITIALIZING ALL TABLES
  // ----------------------------------
  tables.forEach(tbl => {

let headers = Array.isArray(tbl.headers)
    ? tbl.headers
    : JSON.parse(tbl.headers);
    let rows = Array.isArray(tbl.rows)
    ? tbl.rows
    : JSON.parse(tbl.rows);
    let filteredRows = [...rows];

    let page = 1;
    let sortColumn = null;
    let sortAsc = true;

    const tBody       = document.getElementById(`${tbl.id}-tableBody`);
    const searchInput = document.getElementById(`${tbl.id}-searchInput`);
    const rowsSelect  = document.getElementById(`${tbl.id}-rowsSelect`);
    const pagination  = document.getElementById(`${tbl.id}-pagination`);
    const exportBtn   = document.getElementById(`${tbl.id}-csvExport`);

    let rowsPerPage = parseInt(rowsSelect.value);

    function renderPagination() {
      pagination.innerHTML = "";
      const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement("li");
        li.className = "page-item " + (i === page ? "active" : "");
        const btn = document.createElement("button");
        btn.className = "page-link";
        btn.innerText = i;
        btn.onclick = () => { page = i; renderTable(); };
        li.appendChild(btn);
        pagination.appendChild(li);
      }
    }

    function renderTable() {
      tBody.innerHTML = "";
      const q = searchInput.value.toLowerCase();
      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;

      filteredRows.slice(start, end).forEach((row, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td><strong>${start + i + 1}</strong></td>`;
        headers.forEach(h => {
          const val = (row[h] || "").toString();
          tr.innerHTML += `<td>${highlight(val, q)}</td>`;
        });
        tBody.appendChild(tr);
      });

      renderPagination();
    }

    function sortByColumn(index) {
      const key = headers[index];
      sortAsc = sortColumn === key ? !sortAsc : true;
      sortColumn = key;

      filteredRows.sort((a, b) =>
        sortAsc
          ? tamilSort(a[key] || "", b[key] || "")
          : tamilSort(b[key] || "", a[key] || "")
      );

      page = 1;
      renderTable();
    }

    function applySearch() {
      const q = searchInput.value.toLowerCase();
      filteredRows = rows.filter(row =>
        Object.values(row).some(v =>
          (v || "").toString().toLowerCase().includes(q)
        )
      );
      page = 1;
      renderTable();
    }

    // CSV Export
    exportBtn.onclick = () => {
      let csv = [
        headers.join(","),
        ...rows.map(r => headers.map(h => `"${(r[h] || "").toString().replace(/"/g,'""')}"`).join(","))
      ].join("\n");

      const blob = new Blob([csv], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${tbl.id}.csv`;
      a.click();
    };

    rowsSelect.onchange = () => {
      rowsPerPage = parseInt(rowsSelect.value);
      page = 1;
      renderTable();
    };

    searchInput.oninput = applySearch;

    document
      .querySelectorAll(`#${tbl.id}-mainTable th.sortable`)
      .forEach((th, i) => th.onclick = () => sortByColumn(i));

    // INITIAL RENDER
    renderTable();
  });

})();
</script>
