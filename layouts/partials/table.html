
<style>
  /* Sticky header */
  .table-responsive {
    max-height: 450px;
    overflow-y: auto;
  }
  thead th {
    position: sticky;
    top: 0;
    background: #212529;
    color: #fff;
    z-index: 10;
  }
  .styled-select option:hover,
  .styled-select option:checked,
  .styled-select option:focus {
    background-color: #743526 !important;
    color: white !important;
  }

  .styled-select option:focus {
  outline: none;
  background-color: #743526 !important;
  color: white !important;
}


  /* Zebra rows */
  tbody tr:nth-child(even) {
    background-color: #f8f9fa;
  }

  /* Highlight search matches */
  .highlight {
    background: #ffe066;
    padding: 2px 4px;
    border-radius: 4px;
  }

  .table-responsive {
    max-height: 450px;
    overflow-y: auto;
}

/* PAGINATION COLORS */
.pagination .page-item.active .page-link {
  background-color: #ffa323 !important;
  border-color: #ffa323 !important;
  color: white !important;
}

.pagination .page-item .page-link {
  color: #ffa323;
  background: white;
}

/* Hover */
.pagination .page-item .page-link:hover {
  background-color: #ffa323;
  color: white;
}
.export-gap{
    gap:10px;
}
/* THEMED SELECT (Two-tone #3D1A1C + #743526) */
.styled-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-color: white;
  border: 2px solid #743526;              /* Accent border */
  padding: 8px 40px 8px 12px;             /* space for custom arrow */
  border-radius: 8px;

  font-weight: 600;
  color: #3D1A1C;                         /* Dark text */
  cursor: pointer;

  /* Custom SVG arrow in accent color */
  background-image: url("data:image/svg+xml;utf8,\
  <svg fill='%23743526' height='22' width='22' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\
  <path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 16px;

  transition: 0.2s ease-in-out;
}

/* Hover Effect */
.styled-select:hover {
  background-color: #f8f2f3;              /* very soft tint */
  border-color: #743526;
}

/* Focus Glow */
.styled-select:focus {
  outline: none;
  border-color: #743526;
  box-shadow: 0 0 6px rgba(116, 53, 38, 0.6); /* Accent glow */
}

/* Dropdown list styling */
.styled-select option {
  font-weight: 500;
  color: #3D1A1C;
  background: white;
}


thead th {
  position: sticky;
  top: 60px;   /* adjust based on navbar height */
  z-index: 1;
  background: #212529;
  color: #fff;
}

.export-btn{
    background-color: #3D1A1C;
    color: #fff;
}


.export-btn:hover{
    background-color: #fff;
    color: #3D1A1C;
    border: 1px solid #3D1A1C;
}

/* MAKE EVERYTHING SMALLER ON MOBILE (REVERT COMPLEX CHANGES) */
@media (max-width: 576px) {

  /* Reduce table font size */
  #mainTable td,
  #mainTable th {
    font-size: 11px;
    padding: 6px 8px;
  }

  /* Make search input smaller */
  #searchInput {
    margin-bottom: 14px;
    width: 100% !important;
    font-size: 14px;
    padding: 6px 10px;
    min-width: 180px;
  }

  /* Smaller select dropdown */
  .styled-select {
    width: 45%;
    padding: 6px 28px 6px 8px;
    font-size: 14px;
    border-width: 1.5px;
  }

  /* Smaller export button */
  .export-btn {
    width: 45%;
    font-size: 14px;
    padding: 6px 12px;
  }

  /* Reduce top bar spacing */
  .export-gap {
    width: 100%;
    justify-content:space-between;
    /* gap: 6px; */
  }

  /* Table header smaller */
  thead th {
    font-size: 13px;
    padding: 6px 8px;
  }

  /* Pagination smaller */
  .pagination .page-link {
    padding: 4px 8px;
    font-size: 13px;
  }
}

</style>

<div class="pt-4 mb-5">

  <!-- TOP BAR -->
  <div class="d-flex justify-content-between flex-wrap mb-3 gap-3">

    <!-- Search -->
    <input id="searchInput" type="text" class="form-control w-auto" style="min-width:250px"
           placeholder="Search...">

    <div class="d-flex export-gap">

      <!-- Rows per page -->
      <select id="rowsSelect" class="styled-select">
        <option value="10" selected>10 rows</option>
        <option value="20">20 rows</option>
        <option value="50">50 rows</option>

      </select>

      <!-- Export CSV -->
      <button id="csvExport" class="btn export-btn">
        Export CSV
      </button>
    </div>
  </div>

  <!-- TABLE -->
    <table class="table table-hover table-borderless mb-0" id="mainTable">
   <thead class="table-dark">
    <tr>
        <th>S.No</th>
        {{ range .headers }}
        <th class="sortable" data-key="{{ . }}" style="cursor:pointer;">
            {{ . }} <span class="opacity-50">▲▼</span>
        </th>
        {{ end }}
    </tr>
    </thead>


      <tbody id="tableBody"></tbody>
    </table>



<!-- NORMAL PAGINATION (under the table) -->
<nav class="mt-3">
  <ul id="pagination" class="pagination justify-content-center"></ul>
</nav>

</div>


<script>
(() => {

  const __tableHeaders = {{ .headers | jsonify }};
  const __tableRows = {{ .rows | jsonify }};

  let tableHeaders = Array.isArray(__tableHeaders) ? __tableHeaders : JSON.parse(__tableHeaders);
  let tableRows = Array.isArray(__tableRows) ? __tableRows : JSON.parse(__tableRows);

  let filteredRows = [...tableRows];

  const tBody = document.getElementById("tableBody");
  const searchInput = document.getElementById("searchInput");
  const rowsSelect = document.getElementById("rowsSelect");
  const pagination = document.getElementById("pagination");
  const exportBtn = document.getElementById("csvExport");

  let page = 1;
  let rowsPerPage = parseInt(rowsSelect.value);
  let sortColumn = null;
  let sortAsc = true;

  //----------------------------------------------------
  // Tamil highlight
  //----------------------------------------------------
function highlight(text, query) {
  if (!query) return text;

  // Use Unicode-aware segmentation (Tamil safe)
  const segmenter = new Intl.Segmenter("ta", { granularity: "grapheme" });
  const graphemes = Array.from(segmenter.segment(text));
  const q = query.toLowerCase();

  return graphemes
    .map(g => {
      const part = g.segment;
      return part.toLowerCase().includes(q)
        ? `<span class="highlight">${part}</span>`
        : part;
    })
    .join("");
}


  //----------------------------------------------------
  // Tamil sorting
  //----------------------------------------------------
  function tamilSort(a, b) {
    return a.localeCompare(b, "ta", { sensitivity: "base" });
  }

  //----------------------------------------------------
  // SORT FUNCTION (ASC / DESC)
  //----------------------------------------------------
  function sortByColumn(index) {
    let key = tableHeaders[index];

    if (sortColumn === key) {
      sortAsc = !sortAsc;  // toggle direction
    } else {
      sortAsc = true;      // reset direction
      sortColumn = key;
    }

    filteredRows.sort((a, b) => {
      let A = a[key] || "";
      let B = b[key] || "";
      let cmp = tamilSort(A, B);
      return sortAsc ? cmp : -cmp;
    });

    page = 1;
    renderTable();
  }

  //----------------------------------------------------
  // Pagination UI
  //----------------------------------------------------
  function renderPagination() {
    pagination.innerHTML = "";

    const total = filteredRows.length;
    const totalPages = Math.ceil(total / rowsPerPage);

    for (let i = 1; i <= totalPages; i++) {
      const li = document.createElement("li");
      li.className = "page-item " + (i === page ? "active" : "");

      const btn = document.createElement("button");
      btn.className = "page-link";
      btn.innerText = i;
      btn.onclick = () => { page = i; renderTable(); };

      li.appendChild(btn);
      pagination.appendChild(li);
    }
  }

  //----------------------------------------------------
  // Render Table
  //----------------------------------------------------
function renderTable() {
  tBody.innerHTML = "";

  const q = searchInput.value.toLowerCase();
  const start = (page - 1) * rowsPerPage;
  const end = start + rowsPerPage;

  const pageData = filteredRows.slice(start, end);

  pageData.forEach((row, i) => {
    const tr = document.createElement("tr");

    // S.NO column (respects pagination)
    const sno = start + i + 1;
    tr.innerHTML = `<td><strong>${sno}</strong></td>`;

    // Normal columns
    tableHeaders.forEach(h => {
      const val = row[h] || "";
      tr.innerHTML += `<td>${highlight(val.toString(), q)}</td>`;
    });

    tBody.appendChild(tr);
  });

  renderPagination();
}

  //----------------------------------------------------
  // Search filter
  //----------------------------------------------------
  function applySearch() {
    const q = searchInput.value.toLowerCase();
    filteredRows = tableRows.filter(row =>
      Object.values(row).some(v => v.toLowerCase().includes(q))
    );

    page = 1;
    renderTable();
  }

  //----------------------------------------------------
  // CSV Export
  //----------------------------------------------------
  exportBtn.onclick = () => {
    let csv = [];
    csv.push(tableHeaders.join(","));
    tableRows.forEach(row => {
      csv.push(
        tableHeaders.map(h => `"${(row[h] || "").replace(/"/g,'""')}"`).join(",")
      );
    });

    const blob = new Blob([csv.join("\n")], { type:"text/csv" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "table.csv";
    a.click();
  };

  //----------------------------------------------------
  // Events
  //----------------------------------------------------
  rowsSelect.onchange = () => {
    rowsPerPage = parseInt(rowsSelect.value);
    page = 1;    // reset page correctly
    renderTable();
  };

  searchInput.oninput = applySearch;

  document.querySelectorAll("th.sortable").forEach((th, i) => {
    th.onclick = () => sortByColumn(i);
  });

  //----------------------------------------------------
  // INITIAL RENDER
  //----------------------------------------------------
  renderTable();

})();
</script>

